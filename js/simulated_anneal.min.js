var c=document.getElementById("canvas1");var p1=document.getElementById("p1");var p2=document.getElementById("p2");var p3=document.getElementById("p3");var dropDown=document.getElementById("dropDown");var tempBox=document.getElementById("tempBox");var citiesBox=document.getElementById("citiesBox");var width=c.width;var height=c.height;var ctx=c.getContext("2d");var cities=[];var numPts=width/2;var numCities=10;var bestSol;var best=Number.MAX_VALUE;var startTemp=100;var temp=startTemp;function coordinate(a,b){this.x=a;this.y=b}Array.prototype.randomElement=function(){return this[Math.floor(Math.random()*this.length)]};Array.prototype.clone=function(){return this.slice(0)};function generateCities(){var a,d,b;for(a=0;a<numCities;a++){d=Math.random()*(width-10)+10;b=Math.random()*(height-10)+10;cities.push(new coordinate(d,b))}}function drawCircle(a,b){ctx.beginPath();ctx.arc(a,b,3,0,2*Math.PI,false);ctx.fillStyle="#0000ff";ctx.fill();ctx.lineWidth=1;ctx.strokeStyle="#444444";ctx.stroke()}function drawCities(){var a;for(a=0;a<numCities;a++){drawCircle(cities[a].x,cities[a].y)}}function drawLine(d,b){ctx.lineWidth=1;ctx.strokeStyle="#aaaaaa";var a;for(a=0;a<numCities-1;a++){ctx.beginPath();ctx.moveTo(d.x,d.y);ctx.lineTo(b.x,b.y);ctx.stroke()}}function connectCities(){var a;for(a=0;a<numCities-1;a++){drawLine(cities[a],cities[a+1])}}function setupGraph(){var a;ctx.lineWidth=1;ctx.strokeStyle="#DDDDDD";for(a=0;a<height;a+=50){ctx.beginPath();ctx.moveTo(0,a);ctx.lineTo(width,a);ctx.stroke()}for(a=0;a<width;a+=50){ctx.beginPath();ctx.moveTo(a,0);ctx.lineTo(a,height);ctx.stroke()}}function energy(a){var b;var d=0;for(b=0;b<numCities-1;b++){d+=Math.sqrt(Math.pow(a[b].x-a[b+1].x,2)+Math.pow(a[b].y-cities[b+1].y,2))}return d}function neighbor(){var d=Math.floor(Math.random()*numCities);var b=d;while(b===d){b=Math.floor(Math.random()*numCities)}var e=cities.slice(0);var a=e[d];e[d]=e[b];e[b]=a;return e}function probFunc(b,d,a){return(Math.random()<Math.exp(-(energy(b)-energy(d))/a))}function redraw(){ctx.canvas.width=ctx.canvas.width;setupGraph();connectCities();drawCities();p2.innerHTML=energy(cities).toFixed(2);if(energy(cities)<best){best=energy(cities);bestSol=cities.slice(0);p3.innerHTML=best.toFixed(2)}}function simulateStep(a){var d=cities;var b=neighbor();if(energy(b)<energy(d)){d=b}else{if(probFunc(b,d,a)){d=b}}cities=d;redraw()}function animate(a){var d=new Date();var b=setInterval(function(){var e=new Date()-d;var f=e/a.duration;temp=a.temp(temp,f);if(temp<=0){temp=0}a.step(temp);p1.innerHTML=temp.toFixed(2);if(temp===0){clearInterval(b);displayFinalSolution()}},a.delay||10)}function linear(a){return a-0.1}function quadratic(a,b){return a-0.1*Math.pow(b,2)}function logarithmic(a,b){return a+0.1*Math.log(b)}function selectCoolingFunc(a,b){switch(dropDown.options[dropDown.selectedIndex].text){case"Linear":return linear(a);case"Quadratic":return quadratic(a,b);case"Logarithmic":return logarithmic(a,b)}}function simulateAnneal(){animate({delay:1,duration:1000,temp:function(a,b){return linear(a)},step:function(a){simulateStep(a)}})}function displayFinalSolution(){cities=bestSol;redraw()}function resimulate(){startTemp=tempBox.value;temp=startTemp;simulateAnneal()}function repick(){startTemp=tempBox.value;numCities=citiesBox.value;temp=startTemp;cities=[];bestSol=[];best=Number.MAX_VALUE;generateCities();redraw();resimulate()}function start(){tempBox.value=startTemp;temp=startTemp;citiesBox.value=numCities;generateCities();redraw();simulateAnneal()};